/*! Fabrik */

define(["jquery","admin/pluginmanager"],function(n,t){return new Class({Extends:t,Implements:[Options,Events],options:{},initialize:function(t,e){this.setOptions(t),this.watchSelector()},watchSelector:function(){void 0!==n?n("#jform_plugin").bind("change",function(t){this.changePlugin(t)}.bind(this)):document.id("jform_plugin").addEvent("change",function(t){t.stop(),this.changePlugin(t)}.bind(this))},changePlugin:function(t){document.id("plugin-container").empty().adopt(new Element("span").set("text",Joomla.JText._("COM_FABRIK_LOADING")));var e=new Request({url:"index.php",evalResponse:!1,evalScripts:function(t,e){var i=/\s*<div[^>]*>(.|\r|\n)*<\/div>\s*/gi;this.templt=i.exec(t),Array.isArray(this.templt)&&(this.templt=this.templt.join("")),this.script=t.replace(i,"")}.bind(this),data:{option:"com_fabrik",task:"visualization.getPluginHTML",format:"raw",plugin:t.target.get("value")},update:document.id("plugin-container"),onComplete:function(t){document.id("plugin-container").set("html",t);var e=document.querySelector("div.subform-repeatable");if(e){if(e&&"string"==typeof this.templt&&""!==this.templt){var i=document.createElement("script");i.className="subform-repeatable-template-section",i.setAttribute("type","text/subform-repeatable-template-section"),i.textContent=this.templt,e.appendChild(i)}n("div.subform-repeatable").subformRepeatable()}Browser.exec(this.script),this.updateBootStrap(),FabrikAdmin.reTip(),Joomla.setUpShowon&&Joomla.setUpShowon()}.bind(this)});Fabrik.requestQueue.add(e)}})});