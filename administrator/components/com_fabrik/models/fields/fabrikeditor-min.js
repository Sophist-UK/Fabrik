/*! Fabrik */

"use strict";define(["fab/fabrik","admin/namespace","lib/ace/src-min-noconflict/ace"],function(h,e){e.model.fields.fabrikeditor=e.model.fields.fabrikeditor||{};var t=new Class({Implements:[Options,Events],options:{theme:"github",mode:"php",height:"142px",width:"100%"},initialize:function(e,t){if(this.setOptions(t),null!==document.getElementById(e))this.initializeAce(e,t);else{if(e.includes("X__")){var i=document.querySelector("script.subform-repeatable-template-section");if(null!==i&&(i.text||i.textContent).includes(e))return}fconsole("fabrikeditor: unable to find element to initialise:",e)}},initializeAce:function(e,t){this.id=e;var i,n,o=document.getElementById(e),s=o.parentElement;"div"===s.get("tag")&&"-aceContainer"===s.id.slice(-13)||((i=document.createElement("div")).id=e+"-aceContainer",(n=document.createElement("div")).id=e+"-ace",i.appendChild(n),(i=s.insertBefore(i,o)).appendChild(o));var a=e+"_"+("00000"+(16777215*Math.random()).toString(16)).slice(-6);(i=o.parentElement).id=a+"-aceContainer";var l="px"===this.options.height.slice(-2)?this.options.height:28*this.options.height.toInt()+2;if(i.style="position:relative; width:"+this.options.width+"; height:"+l+";",n=i.querySelector("[id$='-ace']")){n.id=a+"-ace",n.className+="FbEditorAce";var r=ace.edit(a+"-ace");r.setTheme("ace/theme/"+this.options.theme);var d="php"===this.options.mode?{path:"ace/mode/php",inline:!0}:"ace/mode/"+this.options.mode;r.getSession().setMode(d),r.$blockScrolling=1/0,r.setValue(o.value),r.navigateFileStart(),r.setAnimatedScroll(!0),r.setBehavioursEnabled(!0),r.setDisplayIndentGuides(!0),r.setHighlightGutterLine(!0),r.setHighlightSelectedWord(!0),r.setShowFoldWidgets(!0),r.setWrapBehavioursEnabled(!0),r.getSession().setUseWrapMode(!0),r.getSession().setTabSize(2),r.on("blur",function(){o.value!==r.getValue()&&(o.value=r.getValue(),o.fireEvent("change",o)),o.fireEvent("blur",o)}),r.setAutoScrollEditorIntoView(!0),this.updateHeight=function(){var e=r.getSession(),t=r.renderer,i=e.getScreenLength()*t.lineHeight+(t.$horizScroll?t.scrollBar.getWidth():0)+2,n="px"===this.options.height.slice(-2)?this.options.height.toInt():this.options.height*t.lineHeight+(t.$horizScroll?t.scrollBar.getWidth():0)+2;i=i<n?n:i;var o=document.getElementById(a+"-aceContainer");o.getStyle("height").toInt()!==i&&(o.setStyle("height",i.toString()+"px"),r.resize())}.bind(this),this.updateHeight(),r.renderer.on("afterRender",function(){this.updateHeight()}.bind(this)),r.getSession().on("change",this.updateHeight),h.debug&&fconsole("fabrikeditor: initialised",a)}else fconsole("FabrikEditor: cannot find ace container to randomise",e+"-ace")},cloned:function(e,t){h.debug&&fconsole("fabrikeditor: cloned",e),this.initializeAce(e,this.options)}});return window.FabrikEditorElement=t});